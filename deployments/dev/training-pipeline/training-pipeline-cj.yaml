#
# https://kubernetes.io/docs/concepts/workloads/controllers/job/
#
---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: training-pipeline-cj-aed1
  namespace: services
spec:
  # For debugginb you might want to run the job more often:
  # For example:
  # - Every 5 minutes: "*/5 * * * *"
  # - Let's say that now is 11:17 and you want to run it at minute 20: "20 * * * *"
  # Once you see the cronjob is working as expected, you can change it to run as needed for your use case.
  # For crypto price prediction, where patterns between features and targets (if any) are not stable,
  # it probably makes sense to run it every hour.
  schedule: "0 * * * *" # every hour
  jobTemplate:
    spec:
      activeDeadlineSeconds: 3600  # Kill job after 1 hour if stuck
      template:
        spec:
          restartPolicy: OnFailure
          containers:
          - name: training-pipeline
            image: training-pipeline:dev
            imagePullPolicy: Never # Use the local image
            resources:
              requests:
                cpu: "1000m"      # Request 1 CPU core
                memory: "4Gi"     # Request 4Gi memory
              limits:
                cpu: "4000m"      # Max 4 CPU cores for LazyRegressor
                memory: "12Gi"    # Max 12Gi memory for multiple models
            envFrom:
            - configMapRef:
                name: training-pipeline
